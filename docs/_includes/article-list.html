{%- comment -%}
<!--
     This include accepts two parameters (which combine by intersection)
   - publication: restrict articles those with this publication value
   - category: restrict articles those with this category value

     It is intended to next inside markdown content, i.e. within a page layout.
-->
{%- endcomment -%}

{% assign articles = site.articles | sort: 'date' | reverse %}
{% if include.publication %}
{%   assign articles = articles | where: "publication", include.publication %}
{% endif %}
{% if include.category %}
{%   assign articles = articles | where: "categories", include.category %}
{% endif %}

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>
<script src="{{ '/assets/js/search.js' | relative_url }}"></script>
<noscript><style>form.search { display: none; }</style></noscript>
<div class="post-list-wrapper">
  <p class="badge">
    {{ articles.size }} {% if articles.size == 1 %}article{% else %}articles{% endif %}.
  </p>
  
  {%- if articles.size > 0 -%}
  <form class="search"><input type="text" class="search-input" placeholder="Search Titles"><button class="search-button" >Clear</button></form>
  <ul class="post-list" id="search-list">
    {%- for article in articles -%}
    {% assign publication = site.publications | where: "path", article.publication | first %}
    <li class="post-list-item">
      <div class="flex-align">
        
        {%- assign date_format = "%Y/%m/%d" -%}
        <span class="post-date">{{ article.date | date: date_format }}</span>
        
        <span class="post-list-title">
          {% if article.published != false %}
          <a class="post-link" href="{{ article.url | relative_url }}">
            {{ article.title | escape }}
          </a>
          
          {% else %}
          {{   article.title | escape }}
          
          {% endif %}
        </span>
        
        <span class="post-list-publication">
          {% if include.publication %}
          {%   unless article.published != false %}(unpublished){% endunless %}
          {% else %}
          {%   if publication %}
          (<a href="{{ publication.url | relative_url }}" class="post-link">{{ publication.title | escape -}}</a>
          {%-    unless article.published != false -%}; unpublished{%- endunless -%})
          {%   else %}
          (no publication{%-    unless article.published != false -%}; unpublished{%- endunless -%})
          {%   endif %}
          {% endif %}
        </span>
      </div>
      {% if article.subtitle %}
      <div class="post-list-subtitle">{{ article.subtitle | escape }}</div>
      {% endif %}
      
    </li>
    {%- endfor -%}
  </ul>
  {%- endif -%}
</div>
